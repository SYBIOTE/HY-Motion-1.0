# HY-Motion Gradio app (testing / demo)
# Tiny layer on top of the shared base — rebuilds in seconds when only app code changes.
#
# Build (standalone):
#   docker build -f Dockerfile.base -t hymotion-base . && docker build -f Dockerfile.gradio -t hymotion-gradio .
#
# Run:
#   docker run --gpus all -p 8080:8080 hymotion-gradio
#
# Cloud Build:
#   gcloud builds submit --config cloudbuild.yaml \
#     --substitutions=_SERVICE=gradio,_DOCKERFILE=Dockerfile.gradio,_REGION=us-central1

# ── The base image tag is overridden by cloudbuild.yaml via --build-arg ──
ARG BASE_IMAGE=hymotion-base:latest
FROM ${BASE_IMAGE}

# ── Gradio-specific deps (gradio, mmgp, fbxsdkpy, openai) ──
COPY requirements-gradio.txt .
RUN uv pip install --system --no-cache -r requirements-gradio.txt

# ── App code ──
COPY gradio_app.py .
COPY examples/ examples/
COPY assets/ assets/
COPY scripts/ scripts/

EXPOSE 8080

CMD exec python gradio_app.py --model_path ${MODEL_PATH}
